<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>watch - kasl documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">kasl documentation</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="watch-command"><a class="header" href="#watch-command"><code>watch</code> Command</a></h1>
<p>The <code>watch</code> command is the core monitoring functionality of kasl. It tracks user activity to automatically detect work sessions, breaks, and workday boundaries. The command can run in background daemon mode for daily use or in foreground mode for debugging and development.</p>
<h2 id="usage"><a class="header" href="#usage">Usage</a></h2>
<pre><code class="language-bash">kasl watch [OPTIONS]
</code></pre>
<h2 id="options"><a class="header" href="#options">Options</a></h2>
<ul>
<li>
<p><code>--foreground</code>: Run the watcher in the foreground for debugging</p>
<ul>
<li>Provides real-time feedback about detected activity</li>
<li>Shows pause events and workday state changes</li>
<li>Useful for testing configuration changes and troubleshooting</li>
</ul>
</li>
<li>
<p><code>--stop</code>, <code>-s</code>: Stop any running background watcher process</p>
<ul>
<li>Terminates the background daemon if it's currently running</li>
<li>Safely closes database connections and cleans up system resources</li>
<li>Useful before system shutdown or when restarting with new configuration</li>
</ul>
</li>
</ul>
<h2 id="operating-modes"><a class="header" href="#operating-modes">Operating Modes</a></h2>
<h3 id="background-daemon-mode-default"><a class="header" href="#background-daemon-mode-default">Background Daemon Mode (Default)</a></h3>
<pre><code class="language-bash">kasl watch
</code></pre>
<p>Runs silently in the background, perfect for daily use:</p>
<ul>
<li>Automatically starts monitoring when you begin working</li>
<li>Detects work vs. break periods based on configurable thresholds</li>
<li>Records workday start/end times and pause periods</li>
<li>Maintains activity state across application restarts</li>
</ul>
<h3 id="foreground-debug-mode"><a class="header" href="#foreground-debug-mode">Foreground Debug Mode</a></h3>
<pre><code class="language-bash">kasl watch --foreground
</code></pre>
<p>Runs in the terminal with detailed logging:</p>
<ul>
<li>Real-time activity detection feedback</li>
<li>Pause event notifications</li>
<li>Workday state change logging</li>
<li>Configuration testing and validation</li>
</ul>
<h3 id="stop-mode"><a class="header" href="#stop-mode">Stop Mode</a></h3>
<pre><code class="language-bash">kasl watch --stop
</code></pre>
<p>Terminates background monitoring:</p>
<ul>
<li>Stops any running daemon process</li>
<li>Properly closes database connections</li>
<li>Cleans up system resources</li>
</ul>
<h2 id="how-it-works"><a class="header" href="#how-it-works">How It Works</a></h2>
<h3 id="activity-detection"><a class="header" href="#activity-detection">Activity Detection</a></h3>
<p>The monitor tracks these input events:</p>
<ul>
<li><strong>Keyboard presses and releases</strong></li>
<li><strong>Mouse button clicks</strong></li>
<li><strong>Mouse movement</strong></li>
<li><strong>Mouse wheel scrolling</strong></li>
</ul>
<h3 id="work-session-detection"><a class="header" href="#work-session-detection">Work Session Detection</a></h3>
<ol>
<li><strong>Input Detection</strong>: Monitors keyboard and mouse activity using system APIs</li>
<li><strong>Activity Analysis</strong>: Determines work vs. break periods based on configurable thresholds</li>
<li><strong>Database Recording</strong>: Automatically records workday start/end times and pause periods</li>
<li><strong>State Management</strong>: Maintains activity state across application restarts</li>
</ol>
<h3 id="configuration-settings"><a class="header" href="#configuration-settings">Configuration Settings</a></h3>
<p>The monitor behavior is controlled by configuration settings:</p>
<ul>
<li><code>pause_threshold</code>: Seconds of inactivity before recording a pause</li>
<li><code>poll_interval</code>: Milliseconds between activity checks</li>
<li><code>activity_threshold</code>: Seconds of activity needed to start a workday</li>
<li><code>min_pause_duration</code>: Minimum pause length to record (filters noise)</li>
</ul>
<h2 id="examples"><a class="header" href="#examples">Examples</a></h2>
<h3 id="daily-usage"><a class="header" href="#daily-usage">Daily Usage</a></h3>
<pre><code class="language-bash"># Start background monitoring (recommended for daily use)
kasl watch

# Check if monitoring is running
ps aux | grep kasl
</code></pre>
<h3 id="debugging-and-development"><a class="header" href="#debugging-and-development">Debugging and Development</a></h3>
<pre><code class="language-bash"># Run in foreground to see activity detection in real-time
kasl watch --foreground

# Test configuration changes
kasl watch --foreground
# Press Ctrl+C to stop
</code></pre>
<h3 id="system-management"><a class="header" href="#system-management">System Management</a></h3>
<pre><code class="language-bash"># Stop monitoring before system shutdown
kasl watch --stop

# Restart with new configuration
kasl watch --stop
kasl watch
</code></pre>
<h2 id="database-operations"><a class="header" href="#database-operations">Database Operations</a></h2>
<p>During monitoring, the system automatically:</p>
<ul>
<li><strong>Creates workday records</strong> when sustained activity is detected</li>
<li><strong>Records pause start times</strong> when inactivity threshold is exceeded</li>
<li><strong>Records pause end times</strong> when activity resumes</li>
<li><strong>Updates workday end times</strong> when monitoring stops</li>
</ul>
<h2 id="signal-handling"><a class="header" href="#signal-handling">Signal Handling</a></h2>
<p>The daemon process responds to these signals:</p>
<ul>
<li><strong>SIGTERM</strong>: Graceful shutdown (Unix)</li>
<li><strong>SIGINT</strong>: Interrupt signal (Unix)</li>
<li><strong>Ctrl+C</strong>: Console interrupt (Windows)</li>
</ul>
<h2 id="troubleshooting"><a class="header" href="#troubleshooting">Troubleshooting</a></h2>
<h3 id="common-issues"><a class="header" href="#common-issues">Common Issues</a></h3>
<p><strong>Daemon already running</strong></p>
<pre><code class="language-bash"># Check if daemon is running
ps aux | grep kasl

# Stop existing daemon
kasl watch --stop

# Start new daemon
kasl watch
</code></pre>
<p><strong>Permission issues</strong></p>
<pre><code class="language-bash"># Run with elevated permissions if needed
sudo kasl watch --foreground
</code></pre>
<p><strong>Configuration errors</strong></p>
<pre><code class="language-bash"># Test configuration in foreground mode
kasl watch --foreground
</code></pre>
<h3 id="debug-mode"><a class="header" href="#debug-mode">Debug Mode</a></h3>
<p>Enable debug logging for troubleshooting:</p>
<pre><code class="language-bash">RUST_LOG=kasl=debug kasl watch --foreground
</code></pre>
<h3 id="process-management"><a class="header" href="#process-management">Process Management</a></h3>
<pre><code class="language-bash"># Check daemon status
ps aux | grep kasl

# View daemon logs (if configured)
tail -f ~/.local/share/lacodda/kasl/kasl.log

# Force stop daemon (if needed)
pkill -f kasl
</code></pre>
<h2 id="integration-with-other-commands"><a class="header" href="#integration-with-other-commands">Integration with Other Commands</a></h2>
<p>The <code>watch</code> command works with other kasl commands:</p>
<ul>
<li><strong><code>task</code></strong>: Create and manage tasks while monitoring</li>
<li><strong><code>report</code></strong>: Generate reports based on monitored data</li>
<li><strong><code>adjust</code></strong>: Manually adjust times recorded by monitoring</li>
<li><strong><code>pauses</code></strong>: View recorded breaks and pauses</li>
</ul>
<h2 id="best-practices"><a class="header" href="#best-practices">Best Practices</a></h2>
<h3 id="daily-workflow"><a class="header" href="#daily-workflow">Daily Workflow</a></h3>
<ol>
<li><strong>Start monitoring</strong> at the beginning of your workday</li>
<li><strong>Let it run</strong> in the background during work</li>
<li><strong>Stop monitoring</strong> before system shutdown</li>
<li><strong>Review data</strong> using <code>report</code> and <code>pauses</code> commands</li>
</ol>
<h3 id="configuration"><a class="header" href="#configuration">Configuration</a></h3>
<ol>
<li><strong>Adjust thresholds</strong> based on your work patterns</li>
<li><strong>Test settings</strong> using foreground mode</li>
<li><strong>Monitor performance</strong> and adjust as needed</li>
<li><strong>Backup configuration</strong> regularly</li>
</ol>
<h3 id="troubleshooting-1"><a class="header" href="#troubleshooting-1">Troubleshooting</a></h3>
<ol>
<li><strong>Use foreground mode</strong> for debugging</li>
<li><strong>Check system permissions</strong> for input device access</li>
<li><strong>Verify database connectivity</strong></li>
<li><strong>Review logs</strong> for error messages</li>
</ol>
<h2 id="related-commands"><a class="header" href="#related-commands">Related Commands</a></h2>
<ul>
<li><strong><a href="./task.html"><code>task</code></a></strong> - Manage tasks and work items</li>
<li><strong><a href="./report.html"><code>report</code></a></strong> - Generate work reports</li>
<li><strong><a href="./adjust.html"><code>adjust</code></a></strong> - Adjust recorded times</li>
<li><strong><a href="./pauses.html"><code>pauses</code></a></strong> - View recorded breaks</li>
<li><strong><a href="./init.html"><code>init</code></a></strong> - Configure monitoring settings</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../commands/init.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../commands/task.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../commands/init.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../commands/task.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
